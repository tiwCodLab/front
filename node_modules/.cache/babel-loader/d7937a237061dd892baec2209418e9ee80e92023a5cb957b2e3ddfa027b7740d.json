{"ast":null,"code":"var _jsxFileName = \"D:\\\\Intermship\\\\Project1\\\\resevetable\\\\src\\\\pages\\\\LoginPage.js\",\n  _s = $RefreshSig$();\n// file: /page/LoginPage.js\nimport { useState, useCallback, useEffect, useRef } from \"react\";\nimport { useLocation, useNavigate, Link, useNavigation } from \"react-router-dom\";\nimport { useAuth } from \"../utils/AuthProvider\";\nimport Spinner from \"../component/Spinner\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst LoginPage = () => {\n  _s();\n  var _location$state;\n  const auth = useAuth();\n  const [loginLoading, setLoginLoading] = useState(false);\n  const navigate = useNavigate();\n  const navigation = useNavigation();\n  const location = useLocation();\n  let from = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.from) || \"/\";\n  const emailRef = useRef();\n  const errRef = useRef();\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    emailRef.current.focus();\n  }, []);\n  const handleSubmit = async e => {\n    e.preventDefault();\n    const data = new FormData(e.target);\n    const email = data.get(\"email\");\n    const password = data.get(\"password\");\n    try {\n      setLoginLoading(true);\n      const response = await fetch(\"/auth\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          email,\n          password\n        }) // data type match \"Content-Type\" header\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        const accessToken = data === null || data === void 0 ? void 0 : data.accessToken;\n        const roles = data === null || data === void 0 ? void 0 : data.roles;\n        const user = {\n          email,\n          roles,\n          accessToken\n        };\n        await auth.signin(user, () => {\n          return navigate(from, {\n            replace: true\n          });\n        });\n      } else if (response.status === 400) {\n        setError(\"Missing Email or Password\");\n      } else if (response.status === 401) {\n        setError(\"Unauthorized\");\n        console.log(\">>> \", from);\n      } else {\n        setError(\"Login Failed\");\n      }\n    } catch (error) {\n      setError(\"Error. Try again later (\" + error + \")!\");\n    } finally {\n      setLoginLoading(false);\n    }\n    errRef.current.focus();\n  };\n  const redirect = useCallback(() => {\n    if (!loginLoading && auth && auth.user && auth.user.email) {\n      if (from) {\n        return navigate(from, {\n          replace: true\n        });\n      } else {\n        if (window.history.state && window.history.state.idx > 0) {\n          navigate(-1); //, { replace: true });\n        } else {\n          navigate(\"/\", {\n            replace: true\n          });\n        }\n      }\n    }\n  }, [auth, from, loginLoading, navigate]);\n\n  // useEffect to make the redirect callback if user already logon\n  useEffect(() => redirect(), [redirect]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: navigation.state === \"loading\" ? /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSubmit,\n          className: \"login-form\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"Login\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            ref: errRef,\n            className: error ? \"errmsg\" : \"hide\",\n            children: error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"already a menber? \", /*#__PURE__*/_jsxDEV(Link, {\n              to: \"/register\",\n              children: \"Signup\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 98,\n              columnNumber: 35\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-input\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"email\",\n              children: \"Email\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 101,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              name: \"email\",\n              id: \"email\",\n              ref: emailRef,\n              placeholder: \"youremail@site.com\",\n              autoComplete: \"off\",\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 102,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-input\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"password\",\n              children: \"Password\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"password\",\n              name: \"password\",\n              id: \"password\",\n              placeholder: \"password\",\n              autoComplete: \"off\",\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            children: \"Login\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this)\n    }, void 0, false)\n  }, void 0, false);\n};\n_s(LoginPage, \"MxLjpZR3PBRcbCnp8sL1mdE2z7o=\", false, function () {\n  return [useAuth, useNavigate, useNavigation, useLocation];\n});\n_c = LoginPage;\nexport default LoginPage;\nvar _c;\n$RefreshReg$(_c, \"LoginPage\");","map":{"version":3,"names":["useState","useCallback","useEffect","useRef","useLocation","useNavigate","Link","useNavigation","useAuth","Spinner","jsxDEV","_jsxDEV","Fragment","_Fragment","LoginPage","_s","_location$state","auth","loginLoading","setLoginLoading","navigate","navigation","location","from","state","emailRef","errRef","error","setError","current","focus","handleSubmit","e","preventDefault","data","FormData","target","email","get","password","response","fetch","method","headers","body","JSON","stringify","ok","json","accessToken","roles","user","signin","replace","status","console","log","redirect","window","history","idx","children","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","className","ref","to","htmlFor","type","name","id","placeholder","autoComplete","required","_c","$RefreshReg$"],"sources":["D:/Intermship/Project1/resevetable/src/pages/LoginPage.js"],"sourcesContent":["// file: /page/LoginPage.js\r\nimport { useState, useCallback, useEffect, useRef } from \"react\";\r\nimport {\r\n  useLocation,\r\n  useNavigate,\r\n  Link,\r\n  useNavigation,\r\n} from \"react-router-dom\";\r\nimport { useAuth } from \"../utils/AuthProvider\";\r\nimport Spinner from \"../component/Spinner\";\r\nconst LoginPage = () => {\r\n  const auth = useAuth();\r\n  const [loginLoading, setLoginLoading] = useState(false);\r\n\r\n  const navigate = useNavigate();\r\n  const navigation = useNavigation();\r\n  const location = useLocation();\r\n\r\n  let from = location.state?.from || \"/\";\r\n  const emailRef = useRef();\r\n  const errRef = useRef();\r\n\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    emailRef.current.focus();\r\n  }, []);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const data = new FormData(e.target);\r\n    const email = data.get(\"email\");\r\n    const password = data.get(\"password\");\r\n\r\n    try {\r\n      setLoginLoading(true);\r\n      const response = await fetch(\"/auth\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ email, password }), // data type match \"Content-Type\" header\r\n      });\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const accessToken = data?.accessToken;\r\n        const roles = data?.roles;\r\n        const user = { email, roles, accessToken };\r\n        await auth.signin(user, () => {\r\n          return navigate(from, { replace: true });\r\n        });\r\n      } else if (response.status === 400) {\r\n        setError(\"Missing Email or Password\");\r\n      } else if (response.status === 401) {\r\n        setError(\"Unauthorized\");\r\n        console.log(\">>> \", from);\r\n      } else {\r\n        setError(\"Login Failed\");\r\n      }\r\n    } catch (error) {\r\n      setError(\"Error. Try again later (\" + error + \")!\");\r\n    } finally {\r\n      setLoginLoading(false);\r\n    }\r\n    errRef.current.focus();\r\n  };\r\n\r\n  const redirect = useCallback(() => {\r\n    if (!loginLoading && auth && auth.user && auth.user.email) {\r\n      if (from) {\r\n        return navigate(from, { replace: true });\r\n      } else {\r\n        if (window.history.state && window.history.state.idx > 0) {\r\n          navigate(-1); //, { replace: true });\r\n        } else {\r\n          navigate(\"/\", { replace: true });\r\n        }\r\n      }\r\n    }\r\n  }, [auth, from, loginLoading, navigate]);\r\n\r\n  // useEffect to make the redirect callback if user already logon\r\n  useEffect(() => redirect(), [redirect]);\r\n\r\n  return (\r\n    <>\r\n      {navigation.state === \"loading\" ? (\r\n        <Spinner />\r\n      ) : (\r\n        <>\r\n          <div>\r\n            <form onSubmit={handleSubmit} className=\"login-form\">\r\n              <h1>Login</h1>\r\n              <p ref={errRef} className={error ? \"errmsg\" : \"hide\"}>\r\n                {error}\r\n              </p>\r\n              <div>\r\n                already a menber? <Link to=\"/register\">Signup</Link>\r\n              </div>\r\n              <div className=\"form-input\">\r\n                <label htmlFor=\"email\">Email</label>\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"email\"\r\n                  id=\"email\"\r\n                  ref={emailRef}\r\n                  placeholder=\"youremail@site.com\"\r\n                  autoComplete=\"off\"\r\n                  required\r\n                />\r\n              </div>\r\n              <div className=\"form-input\">\r\n                <label htmlFor=\"password\">Password</label>\r\n                <input\r\n                  type=\"password\"\r\n                  name=\"password\"\r\n                  id=\"password\"\r\n                  placeholder=\"password\"\r\n                  autoComplete=\"off\"\r\n                  required\r\n                />\r\n              </div>\r\n              <button type=\"submit\">Login</button>\r\n            </form>\r\n          </div>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default LoginPage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}